# AWS Redshift v.s. AWS Athena

[English](../en/10_aws_redshift_athena.md) | [繁體中文](./10_aws_redshift_athena.md) | [日本語](../ja/10_aws_redshift_athena.md) | [回到索引](../README.md)

| 項目       | **Amazon Redshift**                          | **Amazon Athena**                                                       |
| -------- | -------------------------------------------- | ----------------------------------------------------------------------- |
| **類型**   | 資料倉儲（Data Warehouse）                         | 互動式查詢服務（Serverless SQL 查詢引擎）                                            |
| **服務層級** | 區域級（Region Level）                            | 區域級（Region Level）                                                      |
| **儲存方式** | 將資料匯入 Redshift cluster 的本地儲存                 | 查詢存在 S3 的資料（通常是 Parquet, ORC, JSON, CSV 等）                              |
| **架構**   | 需要事先建立 cluster（或使用 serverless 模式）            | 完全 serverless，無需管理基礎架構                                                  |
| **查詢效能** | 適合大量結構化資料、複雜分析，效能優秀                          | 適合 ad-hoc 查詢，不建議用於大量 join 或複雜邏輯                                         |
| **資料延遲** | 需將資料先載入 Redshift                             | 即時查詢 S3 上的原始資料（無需載入）                                                    |
| **成本模式** | 基於儲存與計算資源計費（按時間、節點計算）                        | 按查詢資料量（每查詢 1TB 的 S3 資料計費）                                               |
| **使用場景** | - 大規模 BI 報表<br>- 經常重複查詢的資料分析<br>- 多維度分析與資料建模 | - 不常查詢但資料量大<br>- ad-hoc 分析<br>- 查詢 raw logs、ETL 中間結果、S3 上的 audit logs 等 |
| **整合性**  | 可與 Redshift Spectrum 查詢外部 S3 資料              | 可與 Glue 整合作為 catalog，方便查詢                                               |

## 選擇指南

### 使用 Redshift 的情況：

1. **需要高效能查詢**
   - 有固定的報表需求
   - 需要複雜的 SQL 查詢（多表 JOIN、複雜的聚合函數）
   - 需要即時查詢回應（< 1 秒）

2. **資料量與查詢頻率**
   - 資料量在 TB 級以上
   - 每天有數百次以上的查詢
   - 查詢模式相對固定

3. **成本考量**
   - 有固定的預算
   - 可以預估使用量
   - 需要長期穩定的服務

### 使用 Athena 的情況：

1. **臨時性查詢需求**
   - 不常需要查詢的資料
   - 探索性資料分析
   - 臨時性的報表需求

2. **資料特性**
   - 資料已經存在 S3
   - 資料格式為 Parquet、ORC 等列式儲存
   - 不需要複雜的資料轉換

3. **成本考量**
   - 查詢頻率不固定
   - 想要按使用量付費
   - 不想維護基礎設施

## 實際應用範例

### Redshift 適用場景：
- 電商平台的銷售分析報表
- 金融業的風險分析模型
- 需要即時更新的 BI 儀表板
- 需要複雜資料建模的應用

### Athena 適用場景：
- 分析 AWS 服務的 CloudTrail 日誌
- 查詢 ELB 的存取日誌
- 分析 S3 的稽核日誌
- 臨時性的資料探索需求

## 效能與成本比較

### Redshift
- 查詢效能：優（複雜查詢 < 1 秒）
- 成本結構：固定成本（cluster） + 變動成本（儲存）
- 適合：高頻率、複雜查詢

### Athena
- 查詢效能：良（簡單查詢 1-5 秒）
- 成本結構：純變動成本（按查詢量計費）
- 適合：低頻率、簡單查詢

## 最佳實踐建議

1. **混合使用策略**
   - 使用 Redshift 處理核心業務報表
   - 使用 Athena 處理日誌分析
   - 利用 Redshift Spectrum 查詢 S3 資料

2. **資料格式優化**
   - 使用 Parquet 或 ORC 格式儲存資料
   - 適當的分區（Partitioning）設計
   - 選擇合適的壓縮方式

3. **成本優化**
   - Redshift：使用 RA3 節點類型
   - Athena：使用資料分區減少掃描量
   - 定期清理不需要的資料

## 常見問題與解答

Q: 如何決定使用 Redshift 還是 Athena？
A: 考慮以下因素：
- 查詢頻率
- 查詢複雜度
- 資料量大小
- 預算限制
- 維護能力

Q: 可以同時使用兩者嗎？
A: 是的，許多企業同時使用：
- Redshift 處理核心業務報表
- Athena 處理日誌分析
- 根據不同需求選擇合適的工具

Q: 如何優化查詢效能？
A: 
- Redshift：使用適當的分配鍵（Distribution Key）
- Athena：使用資料分區和適當的檔案格式
- 兩者：優化 SQL 查詢語句
