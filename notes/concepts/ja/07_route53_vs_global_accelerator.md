# Route 53 と Global Accelerator の性質と違いの比較

[English](../en/07_route53_vs_global_accelerator.md) | [繁體中文](../zh-tw/07_route53_vs_global_accelerator.md) | [日本語](07_route53_vs_global_accelerator.md) | [インデックスに戻る](../README.md)


## 背景

新プロジェクトでは Keycloak を採用し、admin/public node を分離しています：
- Admin node：社内ネットワークのみ、インターネットから直接アクセス不可
- Public node：インターネットから直接アクセス可能、ただし通常は会社のフロントエンドシステムを介してアクセス
- Keycloak は複数リージョンにまたがるアーキテクチャ設計が必要


## 解決策

#### ELB
- ELB はリージョンレベルのリソース
- Classic ELB、Application Load Balancer (ALB)、Network Load Balancer (NLB) のいずれも、単一の AWS リージョンにのみ存在可能。つまり：
- 東京（ap-northeast-1）とシンガポール（ap-southeast-1）の両方のリージョンの EC2 に同じ ELB でトラフィックを分散することはできない
- 各リージョンに独自の ELB が必要

#### Route 53
- Route 53 で複数リージョンの ELB DNS を定義可能
- Route 53 のレイテンシーベースのルーティングやジオロケーションルーティングを活用
- ヘルスチェックを追加して自動フェイルオーバーを実現

#### Global Accelerator
- エニーキャスト IP を提供するグローバルサービス
- 最も近く、健全な ELB に自動的にトラフィックを誘導
- 低レイテンシーと高可用性が必要なシナリオにより適している


## Route 53 について

Route 53 はグローバル DNS サービスであり、リージョンに縛られないコンポーネントです。以下がその性質と分類です：

| 分類角度            | 説明                                   |
| ----------------- | ------------------------------------ |
| **サービスタイプ**    | DNS サービス（Domain Name System）           |
| **作用レベル**        | グローバル（リージョン間、単一サービスで全世界をカバー）            |
| **用途分類**        | ドメイン名解決、トラフィック誘導、ヘルスチェック、高可用性、フォールトトレランス            |
| **動作モード**        | オーソリタティブ DNS ベース        |
| **非リージョン制約**  | ホステッドゾーンとレコードセットは特定の AWS リージョンに属さない |

#### 提供する機能
- DNS ホスティングサービス（Hosted Zone）
  - ドメインの DNS レコード（A, AAAA, CNAME, MX, TXT など）をホスティング
- トラフィックルーティングポリシー
  - シンプルルーティング（単一 IP/サービス）
  - レイテンシーベースルーティング（最低レイテンシーに基づく）
  - ジオロケーションルーティング（ユーザー位置に基づく）
  - 重み付けルーティング（重み付け分散）
  - フェイルオーバールーティング（プライマリーバックアップ切り替え）
- ヘルスチェック
  - ALB、EC2、または任意のエンドポイントに対して定期的なチェックを設定し、不健全なターゲットを自動的に削除
- AWS Global Accelerator または ELB との統合
  - 安定したグローバルネットワークアクセスポイントを提供

#### 重要なポイント
| 特性                  | 説明                                   |
| ------------------- | ------------------------------------ |
| **グローバルリソース**       | 単一の AWS リージョンに縛られない                   |
| **リージョン間ルーティング**   | ヘルスチェックと組み合わせてリージョン間フェイルオーバーを実装可能 |
| **ELB 統合**        | ELB の DNS 名を直接解決可能                   |
| **CloudFront 統合** | CDN のソースルーティング層として機能                       |



## Global Accelerator について

Amazon Global Accelerator と Route 53 はどちらもグローバルレベルのサービスですが、性質が異なり、用途も明確に異なります。

| 分類角度            | 説明                                             |
| --------------- | ---------------------------------------------- |
| **サービスタイプ**        | グローバルアプリケーション加速サービス（エニーキャスト IP + インテリジェントトラフィック誘導）                  |
| **作用レベル**        | グローバル（グローバルネットワーク層）                                 |
| **用途分類**        | トラフィック最適化、高可用性、自動フェイルオーバー、リージョン間速度向上                   |
| **動作レベル**        | TCP/UDP 層、L4 ネットワークパケットルーティング                         |
| **非リージョン制約** | グローバルサービス自体だが、ターゲットは特定リージョンのリソース（ALB など）に接続 |

#### 提供する機能
- 固定のエニーキャスト IP を提供
  - Global Accelerator をデプロイすると固定の IPv4 パブリック IP を取得
  - 世界中のユーザーは自動的に最も近い AWS エッジロケーションに誘導
- 最も近いリージョンへのトラフィック誘導
  - AWS グローバルバックボーンネットワーク経由（パブリックインターネットより高速で安定）
  - ユーザー距離、健全性状態、優先順位に基づいて最適なバックエンドに誘導
- ヘルスチェックと自動フェイルオーバーをサポート
  - あるリージョンで問題が発生した場合、トラフィックは自動的に別の健全なターゲットに切り替え
- ALB、NLB、EC2 をバックエンドとしてサポート
  - ターゲットは複数の異なるリージョンのロードバランサーに設定可能

#### 適したシナリオ
- 低レイテンシーとリアルタイムルーティングが必要なアプリケーション（オンラインゲーム、音声チャット、金融サービスなど）
- 世界中のユーザーが同じサービスにアクセスし、安定した高速なネットワーク体験を期待
- ロードバランサーの DNS 名を公開せずに固定 IP セットを希望
- 複数のリージョンにアプリケーションをデプロイし、レイテンシーベースで自動的にルーティングを希望


## コストについて

Global Accelerator は Route 53 よりも大幅に高額で、通常はレイテンシーに敏感なサービスや、グローバルユーザーを持つ高可用性サービスにのみ適しています。

#### 💰 Route 53 のコスト概念（安価）
| 項目          | コスト（USD）                 |
| ----------- | ----------------------- |
| ホステッドゾーン | \$0.50／月／ドメイン     |
| DNS クエリ      | 約 \$0.40～\$0.60／100万クエリ  |
| ヘルスチェック        | 約 \$0.50／エンドポイント／月 |
- 中規模のウェブサイトでも、Route 53 は月額数ドル程度のコスト

#### 💰 Global Accelerator のコスト概念（高額）
| 項目                   | コスト（USD）                             |
| -------------------- | ----------------------------------- |
| 基本料金（Accelerator 1台あたり） | \$0.025／時間 ≒ \$18／月                 |
| 加速 IP（1個あたり）            | \$0.025／時間 ≒ \$18／月 × 2 IP = \$36 |
| トラフィック料金（入出力）            | 発信元と宛先によって変動（1GB あたり約 \$0.015～\$0.12） |
- GA でグローバルウェブアプリケーションを運用すると、トラフィックなしでも月額 \$50～\$70 程度、トラフィックに応じて追加料金（GB 単位）


## 比較

| 特性          | Route 53                | Global Accelerator     |
| ----------- | ----------------------- | ---------------------- |
| **主な機能**    | DNS 解決とトラフィック誘導             | TCP/UDP トラフィック加速とグローバル誘導      |
| **適したトラフィックタイプ**  | 各種サービス（Web, Email, API）   | レイテンシーに敏感、長接続、ゲームサーバー、リアルタイムインタラクティブサービス |
| **IP 安定性**  | DNS レコードに依存（固定ではない）          | 固定のエニーキャスト IP（IPv4）を提供 |
| **切り替え時間**    | DNS TTL 遅延の可能性（数十秒～数分） | ほぼ即時（秒単位）               |
| **ヘルスチェックとフォールトトレランス** | あり、ただし DNS レベルに依存            | 内蔵自動ヘルスチェックとリアルタイムフェイルオーバー   |
| **誘導ロジック**    | DNS レコード誘導、複数戦略設定可能         | 最も近く、健全なエンドポイントへの自動誘導   |
| **コスト**    | 比較的安価（DNS クエリ数と監視に基づく）  | 比較的高額（トラフィック、加速 IP などに基づく）  |
| **例え** | スマート DNS 誘導 | 国際ネットワーク VIP 専用回線 + ルーター |


## 参考文献

- [Amazon Route 53 料金](https://aws.amazon.com/jp/route53/pricing/)
- [AWS Global Accelerator 料金](https://aws.amazon.com/jp/global-accelerator/pricing/) 
