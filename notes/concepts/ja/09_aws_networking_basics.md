# AWS ネットワークの基礎

[English](../en/09_aws_networking_basics.md) | [繁體中文](../zh-tw/09_aws_networking_basics.md) | [日本語](./09_aws_networking_basics.md) | [インデックスに戻る](../README.md)

## 基本サービスの例え
- **ELB (Elastic Load Balancer)**: 入口の案内係のように、利用可能なスタッフに顧客を振り分けます
  - リージョンレベルで動作
- **EC2**: 実際のサービスインスタンス、スタッフ/バックエンドのバリスタのような存在
- **SQS/SNS**: サービス間のバッファー、レジ係とバリスタの間の注文表示板のような役割

## 高可用性（HA）
- 概念：コーヒーショップの支店展開のように、一店舗が利用できない場合でも他の店舗を利用可能
- リージョン選択時の主要な考慮事項：
  - コンプライアンス
  - 地理的近接性
  - 機能の可用性
  - 価格

## VPC（Virtual Private Cloud）
- 定義：AWSにおけるリソース分離の概念
- 主要コンポーネント：
  - **Internet Gateway (IGW)**
    - 機能：VPCの外部アクセスポイント
    - 例え：コーヒーショップの正面入口
  - **Virtual Private Gateway (VGW)**
    - 機能：セキュアなVPN接続を提供（サイト間VPN接続におけるAmazon側のVPNエンドポイントとして機能し、単一のVPCに接続可能）
    - 使用例：VPCへの安全な接続が必要な企業内ネットワーク
  - **AWS Direct Connect**
    - 機能：企業データセンターとAWS VPC間の物理的な専用回線接続を提供

## サブネットネットワークセグメンテーション
#### タイプ
- **パブリックサブネット**
  - 特徴：IGWへの直接アクセスが可能
  - 例え：コーヒーショップのフロントカウンターエリア
- **プライベートサブネット**
  - 特徴：IGWへの直接アクセスが不可
  - 例え：コーヒーショップのバックエンド作業エリア

#### ネットワークセキュリティメカニズムの比較

| 機能 | セキュリティグループ（SG） | ネットワークACL（ACL） |
|------|------------------------|---------------------|
| 動作レベル | インスタンスレベル | サブネットレベル |
| 状態 | ステートフル | ステートレス |
| デフォルトルール | すべてのインバウンドトラフィックを拒否 | すべてのトラフィックを許可 |
| トラフィック方向 | インバウンドのみ | インバウンドとアウトバウンド両方 |
| 例え | ビルの警備員 | 入国審査官 |
| ルール制限 | 少ない | 多い |
| ルール優先順位 | すべてのルールを評価 | 順次評価 |

## ネットワークトラフィックフローの例
subnet1.instanceAからsubnet2.instanceBへのパケット移動プロセス：

1. 送信フェーズ：
   - subnet1.instanceAのSGがアウトバウンドトラフィックを許可
   - subnet1のACLがチェックして許可
   - subnet2のACLがチェックして許可
   - subnet2.instanceBのSGがチェックして許可

2. 応答フェーズ：
   - subnet2.instanceBのSGがアウトバウンドトラフィックを許可
   - subnet2のACLがチェックして許可
   - subnet1のACLがチェックして許可
   - subnet1.instanceAのSGが自動的に許可（ステートフル）

## Terraformリソース関係
リソース間の関係：
- EC2インスタンスは関連するサブネット/SGを定義する必要がある
- サブネットは関連するVPCを定義する必要がある
- SGは関連するVPCを定義する必要がある
- ACLは関連するVPC + サブネットを定義する必要がある

関係図：
```
VPC
├── サブネット
│   ├── ACL
│   └── EC2インスタンス
│       └── セキュリティグループ
└── セキュリティグループ
```

## 参考文献
- [ネットワークアクセスコントロールリストでサブネットトラフィックを制御する](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html)
- [セキュリティグループを使用してAWSリソースへのトラフィックを制御する](https://docs.aws.amazon.com/vpc/latest/userguide/vpc-security-groups.html) 