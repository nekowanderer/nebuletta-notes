# Kubernetes 運算架構基本概念

[English](../en/07_k8s_computing_architecture.md) | [繁體中文](../zh-tw/07_k8s_computing_architecture.md) | [日本語](../ja/07_k8s_computing_architecture.md) | [回到索引](../README.md)

```
+----------------------------------------------------------------------------+
| Cluster                                                                    |
|                                                                            |
| +--------------------+   +--------------------+   +--------------------+   |
| |        Pod         |   |        Pod         |   |        Pod         |   |
| |  +-------------+   |   |  +-------------+   |   |  +-------------+   |   |
| |  |  Container  |   |   |  |  Container  |   |   |  |  Container  |   |   |
| |  |  Image [v2] |   |   |  |  Image [v2] |   |   |  |  Image [v1] |   |   |
| |  +-------------+   |   |  +-------------+   |   |  +-------------+   |   |
| +--------------------+   +--------------------+   +--------------------+   |
|           |                        |                        |              |
| +---------------------------------------------+   +-------------------+    |
| |                  ReplicaSet [v2]            |   |  ReplicaSet [v1]  |    |
| +---------------------------------------------+   +-------------------+    |
|           |                        |                        |              |
|           |                        |                        |              |
| +-----------------------------------------------------------------------+  |
| |                           Deployment [v2]                             |  |
| +-----------------------------------------------------------------------+  |
+----------------------------------------------------------------------------+

```

## 核心組件說明

#### Cluster (叢集)
- 最外層的方框，代表整個 Kubernetes 叢集
- 是所有服務運行的基礎環境

#### Pod
- 叢集中有數個 Pod
- Pod 是 Kubernetes 中可以建立和管理的最小部署單位
- 每個 Pod 都有自己的 IP 位址
- 可以包含一個或多個容器

#### Container (容器)
- 在 Pod 內部運行的應用程式
- 容器是從 Image (映像檔) 建立的實例

#### Image (映像檔)
- 用於建立 Container 的樣板
- 圖中有兩種版本的 Image：v1 和 v2 

#### ReplicaSet
- 作用是確保任何時候都有指定數量的 Pod 複本在運行
- 圖中有兩個 ReplicaSet：
  - **ReplicaSet v1**：管理運行 Image v1 的 Pod
  - **ReplicaSet v2**：管理運行 Image v2 的 Pod
- 這張圖要表達的是 Zero-Downtime Rolling Update 的過程，正常來說應該所有 Pod 裡面的 image 都必須是相同版本

#### Deployment
- 這是一個更高層級的物件，用來管理 ReplicaSet
- 透過 Deployment，您可以描述應用程式的期望狀態
  - 例如：使用哪個版本的 Image、需要多少個複本
- Deployment 會負責建立並管理 ReplicaSet 來達到這個狀態

## 應用程式更新流程

#### 更新過程說明
這張圖捕捉了應用程式從 v1 版更新到 v2 版的過渡時刻。Deployment 已經更新到了 v2 版的設定。

#### 更新步驟
1. **開發者更新設定**：更新了 Deployment 的設定，將應用程式的 Image 從 v1 更新到 v2
2. **建立新的 ReplicaSet**：Deployment 建立了一個新的 ReplicaSet v2
3. **啟動新 Pod**：ReplicaSet v2 開始建立使用 Image v2 的新 Pod
4. **逐步替換**：同時，舊的 ReplicaSet v1 會逐漸減少它所管理的舊 Pod (Image v1) 數量

#### 當前狀態
圖中顯示的正是這個過程中的一個瞬間：
- 已經有 2 個 v2 的新 Pod 正在運行
- 同時還有 1 個 v1 的舊 Pod 尚未被終止

#### 完成更新
等到所有新的 v2 Pod 都成功運行後，舊的 ReplicaSet v1 會將其管理的 Pod 數量縮減到 0，整個更新過程就完成了。**這種方式可以確保服務在更新過程中不會中斷。**