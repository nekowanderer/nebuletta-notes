# L4/L7 Network Concepts in Kubernetes Ingress

[English](../en/27_l4_l7.md) | [繁體中文](../zh-tw/27_l4_l7.md) | [日本語](../ja/27_l4_l7.md) | [Back to Index](../README.md)

### OSI Network Model Fundamentals

Before discussing L4/L7 concepts in Kubernetes Ingress, it's essential to understand the basic architecture of the OSI network model:

- **Layer 1 (Physical Layer)**: Cables, fiber optics, and other physical connections
- **Layer 2 (Data Link Layer)**: MAC addresses, Ethernet frames
- **Layer 3 (Network Layer)**: IP addresses, routing
- **Layer 4 (Transport Layer)**: TCP/UDP protocols, ports
- **Layer 5-6 (Session/Presentation Layer)**: Encryption, compression
- **Layer 7 (Application Layer)**: HTTP, HTTPS, FTP, and other application protocols

### Layer 4 (L4) Load Balancing

Layer 4 load balancing operates at the transport layer with the following characteristics:

**Operating Principles:**
- Makes routing decisions based on IP addresses and ports
- Does not inspect packet contents, only source and destination information
- Uses TCP/UDP connection information for load distribution

**Technical Features:**
- **High Performance**: Fast processing with low latency
- **Protocol Agnostic**: Can handle any TCP/UDP-based traffic
- **Simple Routing**: Only forwards based on network information

**Application in Kubernetes:**
```
External Traffic → LoadBalancer Service → Based on IP:Port → Backend Pod
```

**Use Cases:**
- Applications requiring high throughput
- Non-HTTP protocol services (such as databases, TCP services)
- Simple load distribution requirements

### Layer 7 (L7) Load Balancing

Layer 7 load balancing operates at the application layer with more intelligent routing capabilities:

**Operating Principles:**
- Inspects complete HTTP/HTTPS request content
- Routes based on URL paths, hostnames, request headers, etc.
- Can modify request and response content

**Technical Features:**
- **Intelligent Routing**: Makes complex routing decisions based on application layer information
- **Content Awareness**: Can process based on request content
- **Protocol Specific**: Primarily handles HTTP/HTTPS traffic

**Application in Kubernetes:**
```
HTTP Request → Ingress Controller → Based on Host/Path → Specific Service → Pod
```

**Routing Examples:**
- `api.example.com/users` → User Service
- `api.example.com/orders` → Order Service
- `admin.example.com/*` → Admin Service

### L4 vs L7 Services in Kubernetes

**L4 Service (LoadBalancer Service):**
```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-app-l4
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8080
  selector:
    app: my-app
```

**L7 Service (Ingress):**
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-app-l7
spec:
  rules:
  - host: api.example.com
    http:
      paths:
      - path: /users
        pathType: Prefix
        backend:
          service:
            name: user-service
            port:
              number: 80
```

### Choosing L4 or L7?

**When to Choose L4:**
- Need maximum performance and lowest latency
- Handling non-HTTP protocols
- Simple load distribution requirements
- No need for content-based routing

**When to Choose L7:**
- Need routing based on URL paths or hostnames
- Implementing SSL termination
- Need application layer health checks
- Performing request modification or rewriting
- Implementing microservices architecture API Gateway

### Practical Application Scenarios Comparison

**L4 Scenario Examples:**
- Database connection pools (MySQL, PostgreSQL)
- TCP long connection services
- Game servers
- Real-time communication systems

**L7 Scenario Examples:**
- Web application routing
- RESTful API service distribution
- User-based routing (A/B testing)
- Centralized SSL certificate management

### Performance and Functionality Trade-offs

| Feature | L4 Load Balancing | L7 Load Balancing |
|---------|-------------------|-------------------|
| Processing Speed | Fast | Slower |
| Feature Richness | Basic | Rich |
| Routing Intelligence | Simple | Complex |
| Protocol Support | All TCP/UDP | Mainly HTTP/HTTPS |
| Resource Consumption | Low | High |
| Configuration Complexity | Simple | Complex |