# Kubernetes アーキテクチャ概要

[English](../en/03_k8s_architecture_overview.md) | [繁體中文](../zh-tw/03_k8s_architecture_overview.md) | [日本語](../ja/03_k8s_architecture_overview.md) | [インデックスに戻る](../README.md)

---

## Kubernetes アーキテクチャ図

```
+--------------------------- Cluster ----------------------------+
|   +-------------------+                +-------------------+   |
|   |    Master Node    |                |    Worker Node    |   |
|   |  +-------------+  |                |  +-------------+  |   |
|   |  | API Server  |  |                |  | Kubelet     |  |   |
|   |  |             |  |                |  | Service     |  |   |
|   |  +-------------+  |                |  +-------------+  |   |
|   |  | Cluster     |  |    control     |  | Kube Proxy  |  |   |
|   |  | Controller  |  | <============> |  | Service     |  |   |
|   |  | Manager     |  |  communicate   |  +-------------+  |   |
|   |  +-------------+  |                |  | Container   |  |   |
|   |  | Scheduler   |  |                |  | Runtime     |  |   |
|   |  +-------------+  |                |  +-------------+  |   |
|   |  | Cluster     |  |                |                   |   |
|   |  | State       |  |                |                   |   |
|   |  | Store       |  |                |                   |   |
|   |  +-------------+  |                |                   |   |
|   +-------------------+                +-------------------+   |
+----------------------------------------------------------------+
```

---

## マスターノードについて

マスターノードは Kubernetes クラスターの「頭脳」であり、全体の管理、スケジューリング、状態の維持を担当します。主なコンポーネントは以下の通りです：

- **API サーバー**：
  - クラスターの通信ハブであり、すべてのコマンド（CLI、YAML）はまずここを通ります。
  - REST API を提供し、認証、認可、データ検証、スケジューリングを担当します。
- **クラスタコントローラマネージャ**：
  - 各種コントローラ（ノード、レプリカ、エンドポイントなど）を管理し、クラスターの状態が期待通りであることを保証します。
- **スケジューラ**：
  - 新しく作成された Pod を適切なワーカーノードに割り当てます。
- **クラスタステートストア（etcd）**：
  - クラスター全体の状態を保存する分散型キーバリューデータベースです。
- **マスターレプリカノード**：
  - 高可用性を提供し、メインノードが障害発生時に自動的に切り替えます。

---

## ワーカーノードについて

ワーカーノードは、アプリケーションコンテナ（Pod）が実際に稼働する場所です。主なコンポーネントは以下の通りです：

- **Kubelet サービス**：
  - マスターと通信し、ローカル Pod のライフサイクルを管理します。
- **Kube Proxy サービス**：
  - ネットワークプロキシとロードバランシングを担当し、サービスがノード間でアクセスできるようにします。
- **コンテナランタイム**：
  - 実際にコンテナを実行するソフトウェア（例：Docker、Podman など）。

---

## Pod とコンテナレジストリの説明

Kubernetes では、Pod は最小のデプロイ単位です。1つの Pod には1つ以上のコンテナを含めることができます。各コンテナはイメージから起動され、これらのイメージはコンテナレジストリ（ローカルまたはクラウドベース：DockerHub、AWS ECR、GCP GAR、Azure ACR など）に保存されます。

K8S クラスターで Pod をデプロイすると、Kubernetes は指定されたレジストリから該当するイメージを自動的にプルし、ワーカーノード上でコンテナを起動します。

### Pod とコンテナレジストリの関係図

```
            +--------- Cluster ---------+
            |                           |
            |   +-------------------+   |
            |   |        Pod        |   |
            |   |  +-------------+  |   |
            |   |  | Container   |  |   |
            |   |  | +---------+ |  |   |
            |   |  | | Image   | |  |   |
            |   |  | +---------+ |  |   |
            |   |  +------|------+  |   |
            |   +---------|---------+   |
            |             |             |
            +-------------|-------------+
                          | イメージをプル
                          v
+---------------- コンテナレジストリ ---------------+
| Local | DockerHub | AWS ECR | GCP GAR | Azure ACR |
+---------------------------------------------------+
```
- **Pod**：K8S の最小運用単位で、通常は1つのアプリケーションサービスに対応します。
- **Container**：Pod 内で実行される実体コンテナで、イメージから起動されます。
- **Image**：アプリケーションの実行環境スナップショット（コードや依存パッケージなどを含む）。
- **コンテナレジストリ**：イメージを一元管理する場所で、ローカルまたはクラウドベースが利用可能です。
- **自動プル**：K8S は Pod の設定に従い、レジストリからイメージを自動的にプルします。

---

## Pod、Node とリソースプロバイダーの関係

Kubernetes クラスター内の Pod は、異なるワーカーノードに割り当てられて実行されます。これらのワーカーノードは、実際にはさまざまなコンピューティングリソース（リソースプロバイダー）上で稼働しています（例：ローカルマシン、AWS EC2、GCP Compute Engine、Azure VM など）。

この設計により、K8S はオンプレミスでもクラウドでも、柔軟に基盤となるコンピューティングプラットフォームを選択できます。

```
            +---------- Kubernetes Cluster ----------+
            |                                        |
            |   +-----+      +-------------------+   |
            |   | Pod |----> |                   |   |
            |   +-----+      |    Worker Node    |   |
            |   +-----+      |                   |   |
            |   | Pod |----> |                   |   |
            |   +-----+      +-------------------+   |
            |   +-----+      +-------------------+   |
            |   | Pod |----> |                   |   |
            |   +-----+      |    Worker Node    |   |
            |                |                   |   |
            |                +---------|---------+   |
            +--------------------------|-------------+
                                       |
                                       v
       +--------- コンピューティングリソースプロバイダー -----------+
       | Local | AWS EC2 | GCP Compute Engine | Azure VM |
       +-------------------------------------------------+
```
- **Worker Node**：K8S クラスター内で Pod を実行する計算ノード。
- **リソースプロバイダー**：計算リソースを提供するプラットフォームで、ローカルサーバーや主要クラウドベンダーの VM などが含まれます。
- **柔軟なデプロイ**：K8S により、複数のリソースソースを同時に管理でき、ハイブリッドクラウドやマルチクラウド展開が可能です。

---

## 補足

- **高可用性設計**：
  - マスターノードは通常、単一障害点を回避するために複数のレプリカを持ちます。
- **通信方法**：
  - ユーザーは CLI や YAML ファイルを通じて API サーバーとやり取りできます。
  - マスターとワーカーノードは常に通信し、クラスター状態の一貫性を保ちます。
- **スケーラビリティ**：
  - ワーカーノードはワークロードに応じていつでもスケールアップ・ダウン可能です。
- **複数のコンテナランタイム対応**：
  - Docker、Podman など。
- **Kubernetes アーキテクチャ設計理念**：
  - レイヤー化・モジュール化により、管理と保守が容易になります。

--- 