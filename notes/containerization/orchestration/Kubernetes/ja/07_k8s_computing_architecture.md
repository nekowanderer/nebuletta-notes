# Kubernetes コンピューティングアーキテクチャの基本概念

[English](../en/07_k8s_computing_architecture.md) | [繁體中文](../zh-tw/07_k8s_computing_architecture.md) | [日本語](../ja/07_k8s_computing_architecture.md) | [インデックスに戻る](../README.md)

```
+----------------------------------------------------------------------------+
| Cluster                                                                    |
|                                                                            |
| +--------------------+   +--------------------+   +--------------------+   |
| |        Pod         |   |        Pod         |   |        Pod         |   |
| |  +-------------+   |   |  +-------------+   |   |  +-------------+   |   |
| |  |  Container  |   |   |  |  Container  |   |   |  |  Container  |   |   |
| |  |  Image [v2] |   |   |  |  Image [v2] |   |   |  |  Image [v1] |   |   |
| |  +-------------+   |   |  +-------------+   |   |  +-------------+   |   |
| +--------------------+   +--------------------+   +--------------------+   |
|           |                        |                        |              |
| +---------------------------------------------+   +-------------------+    |
| |                  ReplicaSet [v2]            |   |  ReplicaSet [v1]  |    |
| +---------------------------------------------+   +-------------------+    |
|           |                        |                        |              |
|           |                        |                        |              |
| +-----------------------------------------------------------------------+  |
| |                           Deployment [v2]                             |  |
| +-----------------------------------------------------------------------+  |
+----------------------------------------------------------------------------+

```

## コアコンポーネント概要

#### Cluster（クラスター）
- 最外側のボックスは、Kubernetesクラスター全体を表します
- すべてのサービスが実行される基盤環境です

#### Pod
- クラスター内に複数のPodがあります
- Podは、Kubernetesで作成・管理できる最小のデプロイ可能な単位です
- 各Podは独自のIPアドレスを持ちます
- 1つまたは複数のコンテナを含むことができます

#### Container（コンテナ）
- Pod内で実行されるアプリケーション
- コンテナはImageから作成されたインスタンスです

#### Image（イメージ）
- コンテナを作成するためのテンプレート
- 図には2つのバージョンのImageがあります：v1とv2

#### ReplicaSet
- 指定された数のPodレプリカが常に実行されることを保証します
- 図には2つのReplicaSetがあります：
  - **ReplicaSet v1**：Image v1を実行するPodを管理
  - **ReplicaSet v2**：Image v2を実行するPodを管理
- この図はゼロダウンタイムローリングアップデートのプロセスを示しており、通常はすべてのPodが同じバージョンのイメージを含むべきです

#### Deployment
- ReplicaSetを管理するための上位レベルのオブジェクト
- Deploymentを通じて、アプリケーションの希望する状態を記述できます
  - 例：どのバージョンのImageを使用するか、何個のレプリカが必要か
- Deploymentは、この状態を達成するためにReplicaSetを作成・管理する責任があります

## アプリケーション更新プロセス

#### 更新プロセス概要
この図は、アプリケーションがv1からv2に更新される過渡期の瞬間を捉えています。Deploymentは既にv2設定に更新されています。

#### 更新手順
1. **開発者が設定を更新**：Deployment設定を更新し、アプリケーションのImageをv1からv2に変更
2. **新しいReplicaSetを作成**：Deploymentが新しいReplicaSet v2を作成
3. **新しいPodを開始**：ReplicaSet v2がImage v2を使用して新しいPodの作成を開始
4. **段階的置換**：同時に、古いReplicaSet v1が管理する古いPod（Image v1）の数を段階的に削減

#### 現在の状態
図はこのプロセス中の瞬間を示しています：
- 2つの新しいv2 Podが既に実行中
- 1つの古いv1 Podがまだ終了していない

#### 更新完了
すべての新しいv2 Podが正常に実行されると、古いReplicaSet v1が管理するPod数を0にスケールダウンし、更新プロセス全体が完了します。**このアプローチにより、更新プロセス中にサービスが中断されることがありません。** 